{% extends "base.html" %}
{% block title %}AQI Predictor{% endblock %}

{% block content %}
<div class="animate-fade-in space-y-8">
    <div class="glass-card p-6 flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
            <h1 class="text-3xl font-bold text-white flex items-center gap-3">
                <i class="fas fa-calculator text-teal-300"></i>
                AQI Prediction
            </h1>
            <p class="text-slate-400 mt-2">
                Predict AQI based on pollutant levels using our Random Forest model.
            </p>
        </div>
        <button id="use-current-data-btn" class="btn btn-secondary whitespace-nowrap">
            <i id="geolocate-icon" class="fas fa-map-marker-alt"></i>
            <i id="geolocate-spinner" class="fas fa-spinner fa-spin hidden"></i>
            <span id="geolocate-text">Use My Location Data</span>
        </button>
    </div>

    <div class="flex justify-center">
        <div class="w-full max-w-2xl lg:max-w-3xl">
            <div class="glass-card p-6">
                <form id="predict-form" class="space-y-6"> 
                    <fieldset class="border border-slate-700 rounded-lg p-4">
                        <legend class="px-2 text-slate-300 font-medium">Particulates</legend>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-smog w-4 text-center"></i> PM2.5 <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="PM2.5" placeholder="e.g., 25.5" required class="form-input mt-1">
                            </label>
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-smog w-4 text-center"></i> PM10 <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="PM10" placeholder="e.g., 55.0" required class="form-input mt-1">
                            </label>
                        </div>
                    </fieldset>
                    <fieldset class="border border-slate-700 rounded-lg p-4">
                        <legend class="px-2 text-slate-300 font-medium">Nitrogen Oxides & Ammonia</legend>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-leaf w-4 text-center"></i> NO <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="NO" placeholder="e.g., 10.1" required class="form-input mt-1">
                            </label>
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-industry w-4 text-center"></i> NO2 <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="NO2" placeholder="e.g., 22.3" required class="form-input mt-1">
                            </label>
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-atom w-4 text-center"></i> NOx <span class="text-xs">(ppb?)</span></span>
                                <input type="number" step="any" min="0" name="NOx" placeholder="e.g., 35.0" required class="form-input mt-1">
                            </label>
                             <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-leaf w-4 text-center"></i> NH3 <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="NH3" placeholder="e.g., 8.5" required class="form-input mt-1">
                            </label>
                        </div>
                    </fieldset>
                    <fieldset class="border border-slate-700 rounded-lg p-4">
                        <legend class="px-2 text-slate-300 font-medium">Other Gases & Organics</legend>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-fire-alt w-4 text-center"></i> CO <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="CO" placeholder="e.g., 900" required class="form-input mt-1">
                            </label>
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-flask w-4 text-center"></i> SO2 <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="SO2" placeholder="e.g., 5.5" required class="form-input mt-1">
                            </label>
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-sun w-4 text-center"></i> O3 <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="O3" placeholder="e.g., 40.0" required class="form-input mt-1">
                            </label>
                             <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-vial w-4 text-center"></i> Benzene <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="Benzene" placeholder="e.g., 1.5" required class="form-input mt-1">
                            </label>
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-vial w-4 text-center"></i> Toluene <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="Toluene" placeholder="e.g., 8.0" required class="form-input mt-1">
                            </label>
                            <label class="block">
                                <span class="text-slate-400 text-sm flex items-center gap-1"><i class="fas fa-vial w-4 text-center"></i> Xylene <span class="text-xs">(µg/m³)</span></span>
                                <input type="number" step="any" min="0" name="Xylene" placeholder="e.g., 2.0" required class="form-input mt-1">
                            </label>
                        </div>
                    </fieldset>

                    <button type="submit" class="w-full btn btn-primary py-3">
                        <span id="predict-btn-text">Predict AQI</span>
                        <i id="predict-spinner" class="fas fa-spinner fa-spin hidden"></i>
                    </button>
                </form>
                <div id="prediction-result-area" class="mt-8 space-y-6 hidden"> 
                     <h3 class="text-xl font-bold text-white text-center">Prediction Result</h3>
                     <div class="glass-card p-4 max-w-xs mx-auto">
                         <div class="chart-container h-[250px]"><canvas id="resultGaugeChart"></canvas></div>
                     </div>
                    <div id="prediction-result" class="text-center p-4 rounded-lg"></div>
                     <div class="glass-card p-4">
                         <h4 class="text-lg font-semibold text-center mb-2 text-white">Pollutant Sub-Index Contribution</h4>
                         <p class="text-xs text-slate-400 text-center mb-3">(Higher bar indicates greater contribution to the overall AQI)</p>
                         <div class="chart-container h-[300px]"><canvas id="contributionChart"></canvas></div>
                     </div>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/predictor_v3.js') }}"></script>
{% endblock %}